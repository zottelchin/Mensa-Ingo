package main

import (
	"fmt"
	"html/template"
	"io/ioutil"
	"net/http"
	"regexp"
)

var url string = "https://www.studentenwerk-magdeburg.de/mensen-cafeterien/heute-in-unseren-mensen/"

func handler(w http.ResponseWriter, r *http.Request) {
	cont, _ := ioutil.ReadFile("menu.txt")
	content := string(cont[:])
	re := regexp.MustCompile("<div\\sclass='mensa'>.*</div>")
	match := re.FindAllStringSubmatch(content, -1)
	fmt.Println(len(match))
	content = ""
	for i := 0; i < len(match); i++ {
		content += match[i][0]
	}

	t, _ := template.ParseFiles("show.html")
	t.Execute(w, "Hallo Welt!")

	// _, err := fmt.Fprintf(w, "%s", content)
	// if err != nil {
	// 	panic(err)
	// }
}

func main() {
	// startup()
	port := ":8080"
	http.HandleFunc("/", handler)
	http.ListenAndServe(port, nil)
	fmt.Println(port)
}
func startup() {
	resp, err := http.Get(url)
	if err != nil {
		panic(err)
	}
	defer resp.Body.Close()

	cont, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		panic(err)
	}
	ioutil.WriteFile("menu.txt", cont, 0600)
}
